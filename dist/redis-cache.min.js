/*! rediscache by Adam Timberlake created on 2013-10-27 */
!function(a){"use strict";var b=require("q"),c=require("redis"),d=function(){};d.prototype={client:null,key:null,promise:null,options:{expiry:86400},connect:function(a,b,d){return this.client=c.createClient(a||6379,b||"127.0.0.1"),d&&this.client.auth(d),this},configure:function(a){return this.options=a,this},fetch:function(a){var c=b.defer();return this.promise=c.promise,this.key=a,this.client.get(a,function(a,b){return a||!b?(c.reject(),void 0):(c.resolve(b),void 0)}),this},otherwise:function(a){var c=b.defer(),d=this.client,e=this.key,f=this.options;return this.promise.then(function(a){c.resolve(JSON.parse(a))}).fail(function(){a(c,e),c.promise.then(function(a){d.setex(e,f.expiry,JSON.stringify(a))})}),c.promise},remove:function(a){this.client.del(a)}},a.exports=new d}(module);